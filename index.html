<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vaishnava Vibes | Eternal Chanting</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    },
                    colors: {
                        'saffron': '#FF9933',
                        'deep-blue': '#1a237e',
                        'gold': '#FFD700',
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'spin-slow': 'spin 12s linear infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-20px)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .text-glow {
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        .bead-glow {
            box-shadow: 0 0 30px rgba(255, 153, 51, 0.4);
        }
        /* Hide scrollbar for clean look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        ::-webkit-scrollbar-thumb {
            background: #d4af37;
            border-radius: 4px;
        }
    </style>
</head>
<body class="bg-gray-900 text-white overflow-x-hidden min-h-screen relative">
    
    <!-- Background Slideshow/Image -->
    <!-- Background Slideshow/Image -->
    <div class="fixed inset-0 z-0 transition-opacity duration-1000 ease-in-out bg-black flex items-center justify-center p-0 md:p-4" id="bg-container">
        <!-- <div class="absolute inset-0 bg-gradient-to-t from-gray-900 via-transparent to-transparent z-10 pointer-events-none"></div> -->
        <img src="imgs/1000036989.jpg" id="bg-image" class="w-full h-full object-contain object-center scale-100 transition-all duration-700 ease-in-out" alt="Divine Background">
    </div>

    <!-- Main Content -->
    <div class="relative z-20 container mx-auto px-4 py-8 min-h-screen flex flex-col justify-between">
        
        <!-- Header -->
        <header class="flex justify-between items-center animate-fade-in-down">
            <div class="flex items-center gap-3">
                <i class="fas fa-om text-4xl text-saffron drop-shadow-lg"></i>
                <h1 class="text-3xl font-serif italic font-bold bg-clip-text text-transparent bg-gradient-to-r from-saffron to-gold text-glow">
                    Vaishnava Vibes
                </h1>
            </div>
            
            <button onclick="toggleAudio()" id="audio-btn" class="glass rounded-full p-4 transition-all hover:scale-110 hover:bg-white/20 group">
                <i class="fas fa-music text-xl text-saffron group-hover:text-white transition-colors"></i>
            </button>
        </header>

        <!-- Main Chanting Interface -->
        <main class="flex-grow relative z-10 flex flex-col justify-end pb-8" id="click-area">
            
            <!-- Mantra Text (Smaller and at top) -->
            <!-- Top spacer to push content down -->
            <div class="flex-grow"></div>

            <!-- Counter Display (Center) -->
            <div class="text-center mb-8 pointer-events-none select-none relative z-20">
                <div class="inline-flex flex-col items-center justify-center">
                    <span class="text-xs uppercase tracking-[0.3em] text-gray-300 mb-2 text-glow opacity-80">Mantra Count</span>
                    <div class="flex items-baseline gap-4">
                        <h2 id="mantra-count" class="text-8xl md:text-9xl font-serif font-bold text-white drop-shadow-[0_4px_8px_rgba(0,0,0,0.8)] text-glow transition-all duration-100 scale-100">0</h2>
                        <span class="text-2xl text-gray-400 font-serif">/ 108</span>
                    </div>
                    <div class="mt-2 flex items-center gap-2 px-4 py-1 rounded-full glass border border-white/10 bg-black/20 text-saffron">
                        <i class="fas fa-ring text-xs"></i>
                        <span id="round-count" class="text-sm font-medium tracking-wider">Round 1</span>
                    </div>
                </div>
            </div>

            <!-- Mantra Text (Most Bottom) -->
            <div class="text-center mb-4 pointer-events-none fade-in">
                <div class="glass px-6 py-3 rounded-full inline-block backdrop-blur-md bg-black/30 border-white/10">
                    <p class="text-sm md:text-lg font-serif text-yellow-100 tracking-wide drop-shadow-md">
                        <span class="mr-1">Hare Krishna Hare Krishna</span>
                        <span class="mr-1">Krishna Krishna Hare Hare</span>
                        <br class="block md:hidden">
                        <span class="text-saffron mr-1">Hare Rama Hare Rama</span>
                        <span class="text-saffron">Rama Rama Hare Hare</span>
                    </p>
                </div>
            </div>

            <!-- Click area covers everything but header/footer controls -->
            <div class="absolute inset-0 z-0" onclick="incrementCounter(event)"></div>

        </main>

        <!-- Gallery / Footer -->
        <footer class="mt-auto relative z-30">
            <div class="flex overflow-x-auto gap-4 pb-4 px-2 snap-x hide-scroll hidden" id="image-gallery">
                <!-- Javascript will populate this -->
            </div>
            
            <div class="flex justify-between items-end mt-2 text-xs text-gray-400 font-sans border-t border-white/10 pt-3">
                <p>Chant for Peace â€¢ <span id="total-chants-session">0</span> total today</p>
                <div class="flex gap-4">
                    <button onclick="resetCounter()" class="hover:text-red-400 transition-colors pointer-events-auto">Reset Round</button>
                </div>
            </div>
        </footer>
    </div>

    <!-- Audio Elements -->
    <audio id="bg-music" loop>
        <source src="assets/mahamantra.ogg" type="audio/ogg">
    </audio>
    <audio id="click-sound">
        <source src="assets/hairbol.ogg" type="audio/ogg">
    </audio>

    <script>
        // State
        let count = 0;
        let rounds = 0;
        let totalChants = 0;
        const BEADS_PER_ROUND = 108;
        let isPlaying = false;

        // Assets for gallery and background
        let images = [];
        let currentImgIdx = 0;

        // Elements
        const countEl = document.getElementById('mantra-count');
        const roundEl = document.getElementById('round-count');
        const sessionEl = document.getElementById('total-chants-session');
        const bgImage = document.getElementById('bg-image');
        const audioBtn = document.getElementById('audio-btn');
        const bgMusic = document.getElementById('bg-music');
        const clickSound = document.getElementById('click-sound');

        // Init
        // Init
        async function init() {
            try {
                // Attempt to fetch the directory listing of the 'imgs' folder
                const response = await fetch('imgs/');
                if (response.ok) {
                    const text = await response.text();
                    // Parse the HTML directory listing to find image links
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(text, 'text/html');
                    const links = Array.from(doc.querySelectorAll('a'));
                    
                    // Filter for image files and construct paths
                    const foundImages = links
                        .map(link => link.getAttribute('href'))
                        .filter(href => href && /\.(jpeg|jpg|png|gif|webp)$/i.test(href))
                        .map(filename => {
                            // Handle cases where href is full path or relative
                            const cleanName = filename.split('/').pop();
                            return `imgs/${cleanName}`;
                        });

                    if (foundImages.length > 0) {
                        images = foundImages;
                        console.log('Loaded images dynamically:', images);
                    }
                }
            } catch (error) {
                console.warn('Could not auto-scan imgs folder (likely due to no server listing). Using fallback.', error);
            }

            // Fallback if no images found (e.g. if server doesn't support indexing or file:// protocol)
            if (images.length === 0) {
                 // Hardcoded fallback ONLY used if auto-scan fails. 
                 // This ensures the site works somewhat even if broken.
                 images = [
                    'imgs/1000018148.jpg',
                    'imgs/1000036989.jpg',
                    'imgs/1000037444.jpg',
                    'imgs/1000060952.webp',
                    'imgs/1000066432.webp',
                    'imgs/1000088195.jpg',
                    'imgs/1000088203.jpg',
                    'imgs/1000091280.jpg',
                    'imgs/1000121328.webp',
                    'imgs/1000136098.jpg',
                    'imgs/1000143984.jpg',
                    'imgs/1000155306.jpg',
                    'imgs/1000331242.jpg',
                    'imgs/1000438868.jpg',
                    'imgs/1000493562.jpg',
                    'imgs/1000508865.jpg',
                    'imgs/Bihari.jpeg',
                    'imgs/Krishna.jpeg',
                    'imgs/Krishnaa.JPG',
                    'imgs/MahaPrabhu.jpeg',
                    'imgs/RadhaVallabh.jpeg',
                    'imgs/guru.png',
                    'imgs/krishna.png',
                    'imgs/krishnaa.png',
                    'imgs/radha-madhav.jpeg',
                    'imgs/radha-madhav2.jpeg',
                    'imgs/radhaRaman.jpeg',
                    'imgs/radha_krishna.png'
                ];
            }

            // Set initial background if available
            if (images.length > 0) {
               renderGallery(); // Populate (hidden) gallery for preload
               setBackground(images[0]);
            }

            // Load from local storage if needed
            const saved = localStorage.getItem('chantData');
            if (saved) {
                const data = JSON.parse(saved);
                count = data.count || 0;
                rounds = data.rounds || 0;
                updateDisplay();
            }
        }

        // Logic
        function incrementCounter(e) {
            count++;
            totalChants++;
            
            // Change Background on every tap
            if (images.length > 0) {
                currentImgIdx = (currentImgIdx + 1) % images.length;
                setBackground(images[currentImgIdx]);
            }

            // Animations
            triggerRipple(e);
            
            if (count >= BEADS_PER_ROUND) {
                completeRound();
            }

            updateDisplay();
            saveData();
        }

        function completeRound() {
            count = 0;
            rounds++;
            const notification = new Audio('assets/hairbol.ogg'); 
            notification.play().catch(e=>{});
            
            confettiEffect();
        }

        function resetCounter() {
            if(confirm('Reset current round?')) {
                count = 0;
                updateDisplay();
                saveData();
            }
        }

        function updateDisplay() {
            countEl.innerText = count;
            roundEl.innerText = `Round ${rounds + 1}`;
            sessionEl.innerText = totalChants;
        }

        function saveData() {
            localStorage.setItem('chantData', JSON.stringify({ count, rounds }));
        }

        // Audio Toggle
        function toggleAudio() {
            if (isPlaying) {
                bgMusic.pause();
                audioBtn.innerHTML = '<i class="fas fa-music text-xl text-saffron group-hover:text-white transition-colors"></i>';
                audioBtn.classList.remove('animate-pulse');
            } else {
                bgMusic.play().catch(e => alert("Please interact with the page first"));
                audioBtn.innerHTML = '<i class="fas fa-pause text-xl text-saffron group-hover:text-white transition-colors"></i>';
                audioBtn.classList.add('animate-pulse');
            }
            isPlaying = !isPlaying;
        }

        // Gallery
        function renderGallery() {
            const container = document.getElementById('image-gallery');
            images.forEach(img => {
                const el = document.createElement('div');
                el.className = 'flex-shrink-0 w-20 h-20 md:w-24 md:h-24 rounded-xl overflow-hidden cursor-pointer border-2 border-transparent hover:border-saffron transition-all relative group';
                el.innerHTML = `<img src="${img}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500">`;
                el.onclick = () => setBackground(img);
                container.appendChild(el);
            });
        }

        function setBackground(src) {
            // Smooth transition
            // Preload image first to avoid flash
            const img = new Image();
            img.src = src;
            img.onload = () => {
                 bgImage.style.opacity = '0.4'; // fade out slightly
                 setTimeout(() => {
                     bgImage.src = src;
                     bgImage.onload = () => {
                         bgImage.style.opacity = '1'; // fade in fully
                     };
                 }, 150); // faster transition
            };
        }

        function triggerRipple(e) {
            // Create ripple at click position
            const ripple = document.createElement('div');
            ripple.className = 'fixed rounded-full border border-saffron/50 bg-saffron/10 pointer-events-none z-0';
            
            // Get coordinates (handle both click and touch if needed, but here mainly click)
            const x = e ? e.clientX : window.innerWidth / 2;
            const y = e ? e.clientY : window.innerHeight / 2;
            
            ripple.style.left = x + 'px';
            ripple.style.top = y + 'px';
            ripple.style.width = '0px';
            ripple.style.height = '0px';
            ripple.style.transform = 'translate(-50%, -50%)';

            document.body.appendChild(ripple);

            ripple.animate([
                { width: '0px', height: '0px', opacity: 0.8 },
                { width: '300px', height: '300px', opacity: 0 }
            ], {
                duration: 600,
                easing: 'ease-out'
            }).onfinish = () => ripple.remove();

            // Also pulse text
            countEl.style.transform = 'scale(1.2)';
            setTimeout(() => countEl.style.transform = 'scale(1)', 100);
        }

        function confettiEffect() {
            // Simple visual celebration using basic particles
            // (Simplified for vanilla JS without external libraries)
            const colors = ['#FFD700', '#FF9933', '#FFFFFF'];
            for(let i=0; i<30; i++) {
                createParticle(colors[Math.floor(Math.random() * colors.length)]);
            }
        }

        function createParticle(color) {
            const p = document.createElement('div');
            p.style.position = 'fixed';
            p.style.left = '50%';
            p.style.top = '50%';
            p.style.width = '10px';
            p.style.height = '10px';
            p.style.backgroundColor = color;
            p.style.borderRadius = '50%';
            p.style.pointerEvents = 'none';
            p.style.zIndex = '100';
            
            const angle = Math.random() * Math.PI * 2;
            const velocity = 5 + Math.random() * 5;
            const tx = Math.cos(angle) * 100 * (Math.random() + 0.5);
            const ty = Math.sin(angle) * 100 * (Math.random() + 0.5);

            document.body.appendChild(p);

            p.animate([
                { transform: 'translate(0, 0) scale(1)', opacity: 1 },
                { transform: `translate(${tx}px, ${ty}px) scale(0)`, opacity: 0 }
            ], {
                duration: 800 + Math.random() * 400,
                easing: 'ease-out'
            }).onfinish = () => p.remove();
        }

        // Init App
        init();

    </script>
</body>
</html>
